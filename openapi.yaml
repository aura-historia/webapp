openapi: 3.0.0
info:
  title: Blitzfilter Backend API
  description: |
    REST API for the Blitzfilter cloud-native application backend.
    
    This API provides endpoints for item retrieval and search functionality.
    The backend is written in Rust and utilizes event-driven architecture with CQRS and Event-Sourcing,
    hosted entirely on AWS using services like API Gateway, OpenSearch, DynamoDB, SQS, and Lambda.
  version: 1.0.0
  contact:
    name: Blitzfilter Team
    url: https://github.com/blitzfilter
  license:
    name: License
    url: https://github.com/blitzfilter/aws-backend/blob/develop/LICENSE

servers:
  - url: https://api.blitzfilter.com
    description: Production server

paths:
  /api/v1/items/{shopId}/{shopsItemId}:
    get:
      summary: Get a single item
      description: |
        Retrieves a single item by its shop ID and shop's item ID.
        Returns localized content based on Accept-Language header and currency preferences.
        Optionally includes item history when requested.
      operationId: getItem
      tags:
        - Items
      parameters:
        - name: shopId
          in: path
          required: true
          description: Unique identifier of the shop
          schema:
            type: string
            format: uuid
            example: "550e8400-e29b-41d4-a716-446655440000"
        - name: shopsItemId
          in: path
          required: true
          description: Shop's unique identifier for the item
          schema:
            type: string
            format: uuid
            example: "6ba7b810-9dad-11d1-80b4-00c04fd430c8"
        - name: currency
          in: query
          required: false
          description: Currency for price display
          schema:
            $ref: '#/components/schemas/CurrencyData'
          example: EUR
        - name: history
          in: query
          required: false
          description: Whether to include item history in the response
          schema:
            type: boolean
            default: false
          example: false
        - name: Accept-Language
          in: header
          required: false
          description: |
            Preferred language for localized content.
            Supports quality values and multiple languages.
            Supported languages: de, en, fr, es (with regional variants).
          schema:
            type: string
            pattern: '^([a-z]{2}(-[A-Z]{2})?(;q=[0-9](\.[0-9])?)?)(,([a-z]{2}(-[A-Z]{2})?(;q=[0-9](\.[0-9])?)?)*)*$'
          examples:
            single:
              value: "de"
              description: "German"
            multiple:
              value: "en;q=0.9,de;q=0.8"
              description: "English preferred, German as fallback"
            regional:
              value: "en-US"
              description: "US English"
      responses:
        '200':
          description: Item found and returned successfully
          headers:
            Content-Language:
              description: The language of the returned content
              schema:
                $ref: '#/components/schemas/LanguageData'
              example: "de"
            ETag:
              description: The event ID of the item for caching
              schema:
                type: string
                format: uuid
              example: "\"550e8400-e29b-41d4-a716-446655440001\""
            Last-Modified:
              description: When the item was last updated
              schema:
                type: string
                format: http-date
              example: "Wed, 01 Jan 2020 00:00:00 GMT"
            Access-Control-Allow-Origin:
              description: CORS header
              schema:
                type: string
              example: "*"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetItemData'
              example:
                itemId: "550e8400-e29b-41d4-a716-446655440000"
                eventId: "550e8400-e29b-41d4-a716-446655440001"
                shopId: "550e8400-e29b-41d4-a716-446655440000"
                shopsItemId: "6ba7b810-9dad-11d1-80b4-00c04fd430c8"
                shopName: "My Shop"
                title:
                  text: "Amazing Product"
                  language: "en"
                description:
                  text: "This is an amazing product description"
                  language: "en"
                price:
                  currency: "EUR"
                  amount: 2999
                state: "AVAILABLE"
                url: "https://my-shop.com/products/amazing-product"
                images:
                  - "https://my-shop.com/images/product-1.jpg"
                  - "https://my-shop.com/images/product-2.jpg"
                created: "2024-01-01T10:00:00Z"
                updated: "2024-01-01T12:00:00Z"
        '400':
          description: Bad request - invalid parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
              examples:
                missing_shop_id:
                  summary: Missing shop ID
                  value:
                    status: 400
                    error: "BAD_PARAMETER"
                    source:
                      field: "shopId"
                      sourceType: "path"
                missing_shops_item_id:
                  summary: Missing shop's item ID
                  value:
                    status: 400
                    error: "BAD_PARAMETER"
                    source:
                      field: "shopsItemId"
                      sourceType: "path"
                invalid_history:
                  summary: Invalid history parameter
                  value:
                    status: 400
                    error: "BAD_QUERY_PARAMETER_VALUE"
                    source:
                      field: "history"
                      sourceType: "query"
                    message: "Expected any of: 'true' or 'false'. Got: 'invalid'"
        '404':
          description: Item not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
              example:
                status: 404
                error: "ITEM_NOT_FOUND"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
              example:
                status: 500
                error: "INTERNAL_SERVER_ERROR"

  /api/v1/items:
    get:
      summary: Search items
      description: |
        Search for items using a text query with various filtering and sorting options.
        Returns a paginated collection of items matching the search criteria.
      operationId: searchItems
      tags:
        - Items
      parameters:
        - name: q
          in: query
          required: true
          description: Text search query (minimum 3 characters)
          schema:
            type: string
            minLength: 3
          example: "smartphone case"
        - name: language
          in: query
          required: false
          description: Language for search and localized content
          schema:
            $ref: '#/components/schemas/LanguageData'
            default: de
          example: en
        - name: currency
          in: query
          required: false
          description: Currency for price display
          schema:
            $ref: '#/components/schemas/CurrencyData'
            default: EUR
          example: USD
        - name: sort
          in: query
          required: false
          description: Field to sort results by
          schema:
            $ref: '#/components/schemas/SortItemFieldData'
          example: price
        - name: order
          in: query
          required: false
          description: Sort order (only valid when sort is specified)
          schema:
            type: string
            enum: [asc, desc]
          example: asc
        - name: from
          in: query
          required: false
          description: Pagination offset (number of items to skip)
          schema:
            type: integer
            minimum: 0
            default: 0
          example: 0
        - name: size
          in: query
          required: false
          description: Number of items to return per page
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 21
          example: 21
      responses:
        '200':
          description: Search results returned successfully
          headers:
            Access-Control-Allow-Origin:
              description: CORS header
              schema:
                type: string
              example: "*"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CollectionData'
              example:
                items:
                  - itemId: "550e8400-e29b-41d4-a716-446655440000"
                    eventId: "550e8400-e29b-41d4-a716-446655440001"
                    shopId: "550e8400-e29b-41d4-a716-446655440000"
                    shopsItemId: "6ba7b810-9dad-11d1-80b4-00c04fd430c8"
                    shopName: "Tech Store"
                    title:
                      text: "Smartphone Case"
                      language: "en"
                    price:
                      currency: "USD"
                      amount: 1999
                    state: "AVAILABLE"
                    url: "https://tech-store.com/smartphone-case"
                    images:
                      - "https://tech-store.com/images/case-1.jpg"
                    created: "2024-01-01T10:00:00Z"
                    updated: "2024-01-01T12:00:00Z"
                pagination:
                  from: 0
                  size: 21
                  total: 127
        '400':
          description: Bad request - invalid parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
              examples:
                missing_query:
                  summary: Missing search query
                  value:
                    status: 400
                    error: "BAD_PARAMETER"
                    source:
                      field: "q"
                      sourceType: "query"
                query_too_short:
                  summary: Search query too short
                  value:
                    status: 400
                    error: "TEXT_QUERY_TOO_SHORT"
                    source:
                      field: "q"
                      sourceType: "query"
                    message: "Text query must be at least 3 characters long"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
              example:
                status: 500
                error: "INTERNAL_SERVER_ERROR"

  /api/v1/items/search:
    post:
      summary: Complex item search
      description: |
        Performs an advanced search for items using a comprehensive search filter.
        This endpoint accepts a SearchFilterData object in the request body,
        allowing for complex filtering by multiple criteria simultaneously.
        Returns a paginated collection of items matching the search criteria.
      operationId: complexSearchItems
      tags:
        - Items
      parameters:
        - name: sort
          in: query
          required: false
          description: Field to sort results by
          schema:
            $ref: '#/components/schemas/SortItemFieldData'
          example: price
        - name: order
          in: query
          required: false
          description: Sort order (only valid when sort is specified)
          schema:
            type: string
            enum: [asc, desc]
          example: asc
        - name: from
          in: query
          required: false
          description: Pagination offset (number of items to skip)
          schema:
            type: integer
            minimum: 0
            default: 0
          example: 0
        - name: size
          in: query
          required: false
          description: Number of items to return per page
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 21
          example: 21
      requestBody:
        required: true
        description: |
          Search filter configuration with all filtering criteria.
          Unlike the simple text search, this allows filtering by multiple fields,
          price ranges, item states, and date ranges.
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SearchFilterData'
            example:
              language: "en"
              currency: "USD"
              itemQuery: "smartphone case"
              shopNameQuery: "Tech Store"
              price:
                min: 1000
                max: 5000
              state: ["AVAILABLE"]
              created:
                min: "2024-01-01T00:00:00Z"
                max: "2024-12-31T23:59:59Z"
      responses:
        '200':
          description: Complex search results returned successfully
          headers:
            Access-Control-Allow-Origin:
              description: CORS header
              schema:
                type: string
              example: "*"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CollectionData'
              example:
                items:
                  - itemId: "550e8400-e29b-41d4-a716-446655440000"
                    eventId: "550e8400-e29b-41d4-a716-446655440001"
                    shopId: "550e8400-e29b-41d4-a716-446655440000"
                    shopsItemId: "6ba7b810-9dad-11d1-80b4-00c04fd430c8"
                    shopName: "Tech Store"
                    title:
                      text: "Premium Smartphone Case"
                      language: "en"
                    price:
                      currency: "USD"
                      amount: 2999
                    state: "AVAILABLE"
                    url: "https://tech-store.com/premium-case"
                    images:
                      - "https://tech-store.com/images/premium-case-1.jpg"
                    created: "2024-01-15T10:00:00Z"
                    updated: "2024-01-15T12:00:00Z"
                pagination:
                  from: 0
                  size: 21
                  total: 84
        '400':
          description: Bad request - invalid parameters or body
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
              examples:
                missing_body:
                  summary: Missing request body
                  value:
                    status: 400
                    error: "BAD_BODY_VALUE"
                    message: "Body cannot be empty"
                invalid_json:
                  summary: Invalid JSON format
                  value:
                    status: 400
                    error: "BAD_BODY_VALUE"
                    message: "Invalid JSON format"
                invalid_item_query:
                  summary: Invalid item query length
                  value:
                    status: 400
                    error: "BAD_BODY_VALUE"
                    message: "itemQuery must be at least 3 characters long"
                invalid_sort_field:
                  summary: Invalid sort field
                  value:
                    status: 400
                    error: "BAD_QUERY_PARAMETER_VALUE"
                    source:
                      field: "sort"
                      sourceType: "query"
                    message: "Expected any of: 'price', 'updated', 'created'. Got: 'invalid'"
                invalid_order:
                  summary: Invalid sort order
                  value:
                    status: 400
                    error: "BAD_QUERY_PARAMETER_VALUE"
                    source:
                      field: "order"
                      sourceType: "query"
                    message: "Expected any of: 'asc' or 'desc'. Got: 'invalid'"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
              example:
                status: 500
                error: "INTERNAL_SERVER_ERROR"

  /api/v1/search-filters:
    get:
      summary: List user search filters
      description: |
        Retrieves all search filters for the authenticated user.
        Results can be optionally sorted by creation date.
        Requires valid Cognito JWT authentication.
      operationId: getSearchFilters
      tags:
        - Search Filters
      parameters:
        - name: sort
          in: query
          required: false
          description: Field to sort results by
          schema:
            $ref: '#/components/schemas/SortSearchFilterFieldData'
          example: created
        - name: order
          in: query
          required: false
          description: Sort order (only valid when sort is specified)
          schema:
            type: string
            enum: [asc, desc]
            default: asc
          example: desc
        - name: Authorization
          in: header
          required: true
          description: Cognito JWT token for user authentication
          schema:
            type: string
            pattern: '^Bearer [A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+$'
          example: "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
      responses:
        '200':
          description: Search filters retrieved successfully
          headers:
            Access-Control-Allow-Origin:
              description: CORS header
              schema:
                type: string
              example: "*"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CollectionDataUserSearchFilter'
              example:
                items:
                  - userId: "550e8400-e29b-41d4-a716-446655440000"
                    searchFilterId: "6ba7b810-9dad-11d1-80b4-00c04fd430c8"
                    searchFilter:
                      language: "en"
                      currency: "USD"
                      itemQuery: "smartphone"
                      shopNameQuery: "Tech Store"
                      price:
                        min: 1000
                        max: 5000
                      state: ["AVAILABLE"]
                    created: "2024-01-01T10:00:00Z"
                    updated: "2024-01-01T12:00:00Z"
                pagination:
                  from: 0
                  size: 1
                  total: 1
        '400':
          description: Bad request - invalid parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
              examples:
                invalid_sort_field:
                  summary: Invalid sort field
                  value:
                    status: 400
                    error: "BAD_QUERY_PARAMETER_VALUE"
                    source:
                      field: "sort"
                      sourceType: "query"
                    message: "Expected any of: 'created'. Got: 'invalid'"
                invalid_order:
                  summary: Invalid sort order
                  value:
                    status: 400
                    error: "BAD_QUERY_PARAMETER_VALUE"
                    source:
                      field: "order"
                      sourceType: "query"
                    message: "Expected any of: 'asc' or 'desc'. Got: 'invalid'"
        '401':
          description: Unauthorized - invalid or missing JWT token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
              example:
                status: 401
                error: "UNAUTHORIZED"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
              example:
                status: 500
                error: "INTERNAL_SERVER_ERROR"
    post:
      summary: Create a new search filter
      description: |
        Creates a new search filter for the authenticated user.
        The search filter configuration is provided in the request body.
        Returns the created search filter with generated ID and metadata.
        Requires valid Cognito JWT authentication.
      operationId: createSearchFilter
      tags:
        - Search Filters
      parameters:
        - name: Authorization
          in: header
          required: true
          description: Cognito JWT token for user authentication
          schema:
            type: string
            pattern: '^Bearer [A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+$'
          example: "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
      requestBody:
        required: true
        description: Search filter configuration
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SearchFilterData'
            example:
              language: "en"
              currency: "USD"
              itemQuery: "smartphone"
              shopNameQuery: "Tech Store"
              price:
                min: 1000
                max: 5000
              state: ["AVAILABLE"]
              created:
                min: "2024-01-01T00:00:00Z"
                max: "2024-12-31T23:59:59Z"
      responses:
        '201':
          description: Search filter created successfully
          headers:
            Location:
              description: URL of the created search filter
              schema:
                type: string
                format: uri
              example: "https://api.blitzfilter.com/api/v1/search-filters/6ba7b810-9dad-11d1-80b4-00c04fd430c8"
            Content-Language:
              description: The language of the returned content
              schema:
                $ref: '#/components/schemas/LanguageData'
              example: "en"
            Last-Modified:
              description: When the search filter was created/updated
              schema:
                type: string
                format: http-date
              example: "Wed, 01 Jan 2024 12:00:00 GMT"
            Access-Control-Allow-Origin:
              description: CORS header
              schema:
                type: string
              example: "*"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserSearchFilterData'
              example:
                userId: "550e8400-e29b-41d4-a716-446655440000"
                searchFilterId: "6ba7b810-9dad-11d1-80b4-00c04fd430c8"
                searchFilter:
                  language: "en"
                  currency: "USD"
                  itemQuery: "smartphone"
                  shopNameQuery: "Tech Store"
                  price:
                    min: 1000
                    max: 5000
                  state: ["AVAILABLE"]
                created: "2024-01-01T12:00:00Z"
                updated: "2024-01-01T12:00:00Z"
        '400':
          description: Bad request - invalid request body
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
              examples:
                missing_body:
                  summary: Missing request body
                  value:
                    status: 400
                    error: "BAD_BODY_VALUE"
                    message: "Body cannot be empty"
                invalid_json:
                  summary: Invalid JSON format
                  value:
                    status: 400
                    error: "BAD_BODY_VALUE"
                    message: "Invalid JSON format"
                invalid_item_query:
                  summary: Invalid item query
                  value:
                    status: 400
                    error: "BAD_BODY_VALUE"
                    message: "itemQuery must be at least 3 characters long"
        '401':
          description: Unauthorized - invalid or missing JWT token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
              example:
                status: 401
                error: "UNAUTHORIZED"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
              example:
                status: 500
                error: "INTERNAL_SERVER_ERROR"

  /api/v1/search-filters/{searchFilterId}:
    get:
      summary: Get a specific search filter
      description: |
        Retrieves a specific search filter by its ID for the authenticated user.
        Returns the complete search filter configuration and metadata.
        Requires valid Cognito JWT authentication.
      operationId: getSearchFilter
      tags:
        - Search Filters
      parameters:
        - name: searchFilterId
          in: path
          required: true
          description: Unique identifier of the search filter
          schema:
            type: string
            format: uuid
          example: "6ba7b810-9dad-11d1-80b4-00c04fd430c8"
        - name: Authorization
          in: header
          required: true
          description: Cognito JWT token for user authentication
          schema:
            type: string
            pattern: '^Bearer [A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+$'
          example: "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
      responses:
        '200':
          description: Search filter found and returned successfully
          headers:
            Content-Language:
              description: The language of the returned content
              schema:
                $ref: '#/components/schemas/LanguageData'
              example: "en"
            Last-Modified:
              description: When the search filter was last updated
              schema:
                type: string
                format: http-date
              example: "Wed, 01 Jan 2024 12:00:00 GMT"
            Access-Control-Allow-Origin:
              description: CORS header
              schema:
                type: string
              example: "*"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserSearchFilterData'
              example:
                userId: "550e8400-e29b-41d4-a716-446655440000"
                searchFilterId: "6ba7b810-9dad-11d1-80b4-00c04fd430c8"
                searchFilter:
                  language: "en"
                  currency: "USD"
                  itemQuery: "smartphone"
                  shopNameQuery: "Tech Store"
                  price:
                    min: 1000
                    max: 5000
                  state: ["AVAILABLE"]
                created: "2024-01-01T10:00:00Z"
                updated: "2024-01-01T12:00:00Z"
        '400':
          description: Bad request - invalid parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
              examples:
                missing_search_filter_id:
                  summary: Missing search filter ID
                  value:
                    status: 400
                    error: "BAD_PATH_PARAMETER_VALUE"
                    source:
                      field: "searchFilterId"
                      sourceType: "path"
                invalid_uuid:
                  summary: Invalid search filter ID format
                  value:
                    status: 400
                    error: "INVALID_UUID"
                    source:
                      field: "searchFilterId"
                      sourceType: "path"
                    message: "Invalid UUID format"
        '401':
          description: Unauthorized - invalid or missing JWT token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
              example:
                status: 401
                error: "UNAUTHORIZED"
        '404':
          description: Search filter not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
              example:
                status: 404
                error: "SEARCH_FILTER_NOT_FOUND"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
              example:
                status: 500
                error: "INTERNAL_SERVER_ERROR"
    delete:
      summary: Delete a search filter
      description: |
        Deletes a specific search filter by its ID for the authenticated user.
        The search filter must exist and belong to the authenticated user.
        Requires valid Cognito JWT authentication.
      operationId: deleteSearchFilter
      tags:
        - Search Filters
      parameters:
        - name: searchFilterId
          in: path
          required: true
          description: Unique identifier of the search filter to delete
          schema:
            type: string
            format: uuid
          example: "6ba7b810-9dad-11d1-80b4-00c04fd430c8"
        - name: Authorization
          in: header
          required: true
          description: Cognito JWT token for user authentication
          schema:
            type: string
            pattern: '^Bearer [A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+$'
          example: "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
      responses:
        '204':
          description: Search filter deleted successfully
          headers:
            Access-Control-Allow-Origin:
              description: CORS header
              schema:
                type: string
              example: "*"
        '400':
          description: Bad request - invalid parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
              examples:
                missing_search_filter_id:
                  summary: Missing search filter ID
                  value:
                    status: 400
                    error: "BAD_PATH_PARAMETER_VALUE"
                    source:
                      field: "searchFilterId"
                      sourceType: "path"
                invalid_uuid:
                  summary: Invalid search filter ID format
                  value:
                    status: 400
                    error: "INVALID_UUID"
                    source:
                      field: "searchFilterId"
                      sourceType: "path"
                    message: "Invalid UUID format"
        '401':
          description: Unauthorized - invalid or missing JWT token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
              example:
                status: 401
                error: "UNAUTHORIZED"
        '404':
          description: Search filter not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
              example:
                status: 404
                error: "SEARCH_FILTER_NOT_FOUND"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
              example:
                status: 500
                error: "INTERNAL_SERVER_ERROR"
    patch:
      summary: Update a search filter
      description: |
        Updates a specific search filter by its ID for the authenticated user.
        Allows partial updates - only provided fields will be modified.
        If no fields are provided in the request body, returns the existing search filter unchanged.
        Requires valid Cognito JWT authentication.
      operationId: updateSearchFilter
      tags:
        - Search Filters
      parameters:
        - name: searchFilterId
          in: path
          required: true
          description: Unique identifier of the search filter to update
          schema:
            type: string
            format: uuid
          example: "6ba7b810-9dad-11d1-80b4-00c04fd430c8"
        - name: Authorization
          in: header
          required: true
          description: Cognito JWT token for user authentication
          schema:
            type: string
            pattern: '^Bearer [A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+$'
          example: "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
      requestBody:
        required: false
        description: |
          Partial search filter update data.
          Only provided fields will be updated. If body is empty, returns existing filter.
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SearchFilterDataPatch'
            examples:
              partial_update:
                summary: Update specific fields
                value:
                  shopNameQuery: "Updated Store"
                  price:
                    min: 2000
                    max: 8000
              empty_update:
                summary: No changes (returns existing filter)
                value: {}
      responses:
        '200':
          description: Search filter updated successfully
          headers:
            Content-Language:
              description: The language of the returned content
              schema:
                $ref: '#/components/schemas/LanguageData'
              example: "en"
            Last-Modified:
              description: When the search filter was last updated
              schema:
                type: string
                format: http-date
              example: "Wed, 01 Jan 2024 12:30:00 GMT"
            Access-Control-Allow-Origin:
              description: CORS header
              schema:
                type: string
              example: "*"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserSearchFilterData'
              example:
                userId: "550e8400-e29b-41d4-a716-446655440000"
                searchFilterId: "6ba7b810-9dad-11d1-80b4-00c04fd430c8"
                searchFilter:
                  language: "en"
                  currency: "USD"
                  itemQuery: "smartphone"
                  shopNameQuery: "Updated Store"
                  price:
                    min: 2000
                    max: 8000
                  state: ["AVAILABLE"]
                created: "2024-01-01T10:00:00Z"
                updated: "2024-01-01T12:30:00Z"
        '400':
          description: Bad request - invalid parameters or body
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
              examples:
                missing_search_filter_id:
                  summary: Missing search filter ID
                  value:
                    status: 400
                    error: "BAD_PATH_PARAMETER_VALUE"
                    source:
                      field: "searchFilterId"
                      sourceType: "path"
                invalid_uuid:
                  summary: Invalid search filter ID format
                  value:
                    status: 400
                    error: "INVALID_UUID"
                    source:
                      field: "searchFilterId"
                      sourceType: "path"
                    message: "Invalid UUID format"
                invalid_json:
                  summary: Invalid JSON format
                  value:
                    status: 400
                    error: "BAD_BODY_VALUE"
                    message: "Invalid JSON format"
                invalid_item_query:
                  summary: Invalid item query length
                  value:
                    status: 400
                    error: "BAD_BODY_VALUE"
                    message: "itemQuery must be at least 3 characters long"
        '401':
          description: Unauthorized - invalid or missing JWT token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
              example:
                status: 401
                error: "UNAUTHORIZED"
        '404':
          description: Search filter not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
              example:
                status: 404
                error: "SEARCH_FILTER_NOT_FOUND"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
              example:
                status: 500
                error: "INTERNAL_SERVER_ERROR"

components:
  schemas:
    GetItemData:
      type: object
      description: Complete item information including metadata and localized content
      required:
        - itemId
        - eventId
        - shopId
        - shopsItemId
        - shopName
        - title
        - state
        - url
        - images
        - created
        - updated
      properties:
        itemId:
          type: string
          format: uuid
          description: Unique internal identifier for the item
        eventId:
          type: string
          format: uuid
          description: Unique identifier for the current state/version of the item
        shopId:
          type: string
          format: uuid
          description: Unique identifier of the shop
        shopsItemId:
          type: string
          format: uuid
          description: Shop's unique identifier for the item
        shopName:
          type: string
          description: Display name of the shop
        title:
          $ref: '#/components/schemas/LocalizedTextData'
        description:
          allOf:
            - $ref: '#/components/schemas/LocalizedTextData'
          nullable: true
          description: Optional item description
        price:
          allOf:
            - $ref: '#/components/schemas/PriceData'
          nullable: true
          description: Optional item price
        state:
          $ref: '#/components/schemas/ItemStateData'
        url:
          type: string
          format: uri
          description: URL to the item on the shop's website
        images:
          type: array
          items:
            type: string
            format: uri
          description: Array of image URLs for the item
          default: []
        created:
          type: string
          format: date-time
          description: When the item was first created (RFC3339 format)
        updated:
          type: string
          format: date-time
          description: When the item was last updated (RFC3339 format)
        history:
          type: array
          items:
            $ref: '#/components/schemas/GetItemEventData'
          nullable: true
          description: Optional array of item history events

    CollectionData:
      type: object
      description: Paginated collection of items
      required:
        - items
        - pagination
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/GetItemData'
          description: Array of items in the current page
        pagination:
          $ref: '#/components/schemas/PaginationData'

    PaginationData:
      type: object
      description: Pagination metadata
      required:
        - from
        - size
        - total
      properties:
        from:
          type: integer
          minimum: 0
          description: Number of items skipped (offset)
        size:
          type: integer
          minimum: 1
          description: Number of items in the current page
        total:
          type: integer
          minimum: 0
          description: Total number of items matching the query

    LocalizedTextData:
      type: object
      description: Text content with language information
      required:
        - text
        - language
      properties:
        text:
          type: string
          description: The text content
        language:
          $ref: '#/components/schemas/LanguageData'

    PriceData:
      type: object
      description: Price information with currency
      required:
        - currency
        - amount
      properties:
        currency:
          $ref: '#/components/schemas/CurrencyData'
        amount:
          type: integer
          description: Price amount in minor currency units (e.g., cents for EUR/USD)
          minimum: 0
          example: 2999

    GetItemEventData:
      type: object
      description: Historical event for an item
      required:
        - eventType
        - itemId
        - eventId
        - shopId
        - shopsItemId
        - payload
        - timestamp
      properties:
        eventType:
          $ref: '#/components/schemas/ItemEventTypeData'
        itemId:
          type: string
          format: uuid
          description: Unique internal identifier for the item
        eventId:
          type: string
          format: uuid
          description: Unique identifier for this event
        shopId:
          type: string
          format: uuid
          description: Unique identifier of the shop
        shopsItemId:
          type: string
          format: uuid
          description: Shop's unique identifier for the item
        payload:
          $ref: '#/components/schemas/ItemEventPayloadData'
        timestamp:
          type: string
          format: date-time
          description: When the event occurred (RFC3339 format)

    LanguageData:
      type: string
      enum: [de, en, fr, es]
      description: |
        Supported languages (ISO 639-1 codes):
        - de: German (includes de-DE, de-AT, de-CH, de-LU, de-LI)
        - en: English (includes en-US, en-GB, en-AU, en-CA, en-NZ, en-IE)
        - fr: French (includes fr-FR, fr-CA, fr-BE, fr-CH, fr-LU)
        - es: Spanish (includes es-ES, es-MX, es-AR, es-CO, es-CL, es-PE, es-VE)
      default: de
      example: en

    CurrencyData:
      type: string
      enum: [EUR, GBP, USD, AUD, CAD, NZD]
      description: |
        Supported currencies (ISO 4217 codes):
        - EUR: Euro
        - GBP: British Pound
        - USD: US Dollar
        - AUD: Australian Dollar
        - CAD: Canadian Dollar
        - NZD: New Zealand Dollar
      default: EUR
      example: EUR

    ItemStateData:
      type: string
      enum: [LISTED, AVAILABLE, RESERVED, SOLD, REMOVED]
      description: |
        Current state of the item:
        - LISTED: Item has been listed
        - AVAILABLE: Item is available for purchase
        - RESERVED: Item is reserved by a buyer
        - SOLD: Item has been sold
        - REMOVED: Item has been removed and can no longer be tracked
      example: AVAILABLE

    SortItemFieldData:
      type: string
      enum: [price, updated, created]
      description: |
        Fields available for sorting:
        - price: Sort by item price
        - updated: Sort by last updated timestamp
        - created: Sort by creation timestamp
      example: price

    ItemEventTypeData:
      type: string
      enum: [STATE_AVAILABLE, PRICE_DROPPED, STATE_LISTED, STATE_RESERVED, STATE_SOLD, STATE_REMOVED]
      description: Types of events that can occur for an item
      example: STATE_AVAILABLE

    ItemEventPayloadData:
      oneOf:
        - $ref: '#/components/schemas/ItemStateData'
        - $ref: '#/components/schemas/PriceData'
      description: Event-specific payload data

    ApiError:
      type: object
      description: Standard error response format
      required:
        - status
        - error
      properties:
        status:
          type: integer
          description: HTTP status code
          example: 400
        error:
          type: string
          description: Error code identifier
          example: "BAD_PARAMETER"
        source:
          $ref: '#/components/schemas/ApiErrorSource'
        message:
          type: string
          description: Human-readable error message
          example: "Expected any of: 'true' or 'false'. Got: 'invalid'"

    ApiErrorSource:
      type: object
      description: Information about the source of the error
      required:
        - field
        - sourceType
      properties:
        field:
          type: string
          description: Name of the field that caused the error
          example: "shopId"
        sourceType:
          type: string
          enum: [query, path, header, body]
          description: Type of parameter that caused the error
          example: "path"

    SearchFilterData:
      type: object
      description: Search filter configuration with query parameters and filtering options
      required:
        - language
        - currency
        - itemQuery
      properties:
        language:
          $ref: '#/components/schemas/LanguageData'
        currency:
          $ref: '#/components/schemas/CurrencyData'
        itemQuery:
          type: string
          description: Text query for searching items (minimum 3 characters)
          minLength: 3
          example: "smartphone case"
        shopNameQuery:
          type: string
          description: Optional text query for filtering by shop name
          minLength: 3
          nullable: true
          example: "Tech Store"
        price:
          allOf:
            - $ref: '#/components/schemas/RangeQueryUInt64'
          nullable: true
          description: Optional price range filter in minor currency units
        state:
          type: array
          items:
            $ref: '#/components/schemas/ItemStateData'
          description: Optional filter by item states
          uniqueItems: true
          default: []
          example: ["AVAILABLE"]
        created:
          allOf:
            - $ref: '#/components/schemas/RangeQueryDateTime'
          nullable: true
          description: Optional filter by item creation date range
        updated:
          allOf:
            - $ref: '#/components/schemas/RangeQueryDateTime'
          nullable: true
          description: Optional filter by item last updated date range

    SearchFilterDataPatch:
      type: object
      description: |
        Partial search filter update data.
        All fields are optional and only provided fields will be updated.
        Follows the same structure as SearchFilterData but with optional fields.
      properties:
        language:
          allOf:
            - $ref: '#/components/schemas/LanguageData'
          nullable: true
          description: Language for search and localized content
        currency:
          allOf:
            - $ref: '#/components/schemas/CurrencyData'
          nullable: true
          description: Currency for price display
        itemQuery:
          type: string
          description: Text query for searching items (minimum 3 characters when provided)
          minLength: 3
          nullable: true
          example: "laptop bag"
        shopNameQuery:
          type: string
          description: Optional text query for filtering by shop name (minimum 3 characters when provided)
          minLength: 3
          nullable: true
          example: "Electronics Store"
        price:
          allOf:
            - $ref: '#/components/schemas/RangeQueryUInt64'
          nullable: true
          description: Optional price range filter in minor currency units
        state:
          type: array
          items:
            $ref: '#/components/schemas/ItemStateData'
          description: Optional filter by item states
          uniqueItems: true
          nullable: true
          example: ["AVAILABLE", "LISTED"]
        created:
          allOf:
            - $ref: '#/components/schemas/RangeQueryDateTime'
          nullable: true
          description: Optional filter by item creation date range
        updated:
          allOf:
            - $ref: '#/components/schemas/RangeQueryDateTime'
          nullable: true
          description: Optional filter by item last updated date range

    UserSearchFilterData:
      type: object
      description: Complete user search filter with metadata
      required:
        - userId
        - searchFilterId
        - searchFilter
        - created
        - updated
      properties:
        userId:
          type: string
          format: uuid
          description: Unique identifier of the user who owns this search filter
          example: "550e8400-e29b-41d4-a716-446655440000"
        searchFilterId:
          type: string
          format: uuid
          description: Unique identifier for this search filter
          example: "6ba7b810-9dad-11d1-80b4-00c04fd430c8"
        searchFilter:
          $ref: '#/components/schemas/SearchFilterData'
        created:
          type: string
          format: date-time
          description: When the search filter was created (RFC3339 format)
          example: "2024-01-01T10:00:00Z"
        updated:
          type: string
          format: date-time
          description: When the search filter was last updated (RFC3339 format)
          example: "2024-01-01T12:00:00Z"

    RangeQueryUInt64:
      type: object
      description: Range query for numeric values (prices in minor currency units)
      properties:
        min:
          type: integer
          minimum: 0
          description: Minimum value (inclusive)
          example: 1000
        max:
          type: integer
          minimum: 0
          description: Maximum value (inclusive)
          example: 5000

    RangeQueryDateTime:
      type: object
      description: Range query for date and time values
      properties:
        min:
          type: string
          format: date-time
          description: Minimum date and time (inclusive, RFC3339 format)
          example: "2024-01-01T00:00:00Z"
        max:
          type: string
          format: date-time
          description: Maximum date and time (inclusive, RFC3339 format)
          example: "2024-12-31T23:59:59Z"

    SortSearchFilterFieldData:
      type: string
      enum: [created]
      description: |
        Fields available for sorting search filters:
        - created: Sort by creation timestamp
      example: created

    CollectionDataUserSearchFilter:
      type: object
      description: Paginated collection of user search filters
      required:
        - items
        - pagination
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/UserSearchFilterData'
          description: Array of search filters in the current page
        pagination:
          $ref: '#/components/schemas/PaginationData'

tags:
  - name: Items
    description: Operations related to item retrieval and search
  - name: Search Filters
    description: Operations for managing user search filters