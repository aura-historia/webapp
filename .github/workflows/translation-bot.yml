name: AI Translation Bot

on:
    push:
        branches:
            - develop
#            TODO: Remove after testing
            - feature/**

env:
    WATCH_FILE: "src/i18n/locales/en/translation.json"
    TARGET_LANGS: "es,fr,de"

jobs:
    translate:
        runs-on: ubuntu-latest
        permissions:
            contents: write
            pull-requests: write

        steps:
            - name: Checkout Code
              uses: actions/checkout@v4
              with:
                  fetch-depth: 2

            - name: Check for File Changes
              id: check_changes
              run: |
                  if git diff --name-only HEAD^ HEAD | grep -q "${{ env.WATCH_FILE }}"; then
                    echo "run_translation=true" >> $GITHUB_OUTPUT
                  else
                    echo "run_translation=false" >> $GITHUB_OUTPUT
                  fi

            - name: Setup Python
              if: steps.check_changes.outputs.run_translation == 'true'
              uses: actions/setup-python@v6.1.0
              with:
                  python-version: '3.14'

            - name: Install Dependencies
              if: steps.check_changes.outputs.run_translation == 'true'
              run: pip install openai

            - name: Run Translation Script
              if: steps.check_changes.outputs.run_translation == 'true'
              env:
                  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
                  TARGET_LANGS: ${{ env.TARGET_LANGS }}
                  SOURCE_FILE: ${{ env.WATCH_FILE }}
                # Simply call the script file
              run: python .github/scripts/translation-bot.py

            - name: Create Pull Request
              if: steps.check_changes.outputs.run_translation == 'true'
              uses: peter-evans/create-pull-request@v6
              with:
                  token: ${{ secrets.GITHUB_TOKEN }}
                  commit-message: "chore: AI auto-translation update"
                  title: "ðŸ¤– AI Translation Update"
                  body: "Auto-generated by GitHub Models."
                  branch: "translation-bot/auto-update"
                  base: "develop"